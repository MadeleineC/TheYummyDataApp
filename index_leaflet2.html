<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>project map</title>
    <script
        src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha256-3edrmyuQ0w65f8gfBsqowzjJe2iM6n0nKciPUp8y+7E="
        crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.0.1/dist/leaflet.js"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script type="text/javascript" src="leaflet-heat.js"></script>

    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.3.0/dist/MarkerCluster.css"/>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.3.0/dist/MarkerCluster.Default.css"/>
    <script type="text/javascript" src="https://unpkg.com/leaflet.markercluster@1.3.0/dist/leaflet.markercluster.js"></script>
    <script type="text/javascript" src="https://unpkg.com/leaflet.markercluster@1.3.0/dist/leaflet.markercluster-src.js"></script>
    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel = "stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.2/leaflet.css"/>
  <script type="text/javascript" src="http://timwis.com/leaflet-choropleth/dist/choropleth.js"></script>
  <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"></script>
  <script type="text/javascript" src="https://unpkg.com/leaflet.markercluster@1.3.0/dist/leaflet.markercluster-src.js"></script>
 
  </head>
<body>

    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="index_leaflet.html">
                <span class="glyphicon glyphicon-bookmark" aria-hidden="true"></span>
                &nbsp; <strong>Y</strong>ummy data map &nbsp;
            </a>
            </div>
            <ul class="nav navbar-nav navbar-right">

                <!-- 
                    this one will be a JS popup on click explaining on things work 
                -->

                    <li><a href="#"><span class ='' aria-hidden='true'></span>&nbsp; FAQ</a></li>

                <!-- 
                    this one will just be a generic contact us button (email or something)
                 -->

                    <li><a href="contact.html"><span class ='' aria-hidden='true'></span>&nbsp; Contact Us</a></li>
                   
                </ul>
                                <!-- <ul class="nav navbar-nav navbar-right">
                                    <form class="form-inline">
                                        <div class="form-group mb-2">
                                            <input type="text" class="form-control" id="city" placeholder="City">
                                        </div>
                                        <div class="form-group mx-sm-3 mb-3">
                                            <input type="text" class="form-control" id="state" placeholder="State">
                                        </div>
                                        <div class="form-group mx-sm-3 mb-3">
                                            <input type="text" class="form-control" id="cuisine" placeholder="Cuisine">
                                        </div>
                                        <a class="btn btn-primary btn-lg" href="/fetch" role="button">Search</a>
                                    </form>
                                </ul> -->



            </div><!-- /.navbar-collapse -->
        </nav>    
        <div class="row">
        <ul class="nav navbar-nav navbar-right">
                <form class="form-inline">
                  <div class="form-group mb-2">
                      <input type="text" class="form-control" id="city" placeholder="City">
                  </div>
                  <div class="form-group mx-sm-3 mb-3">
                      <input type="text" class="form-control" id="state" placeholder="State">
                  </div>
                  <div class="form-group mx-sm-3 mb-3">
                      <input type="text" class="form-control" id="cuisine" placeholder="Cuisine">
                  </div>
                  <a class="btn btn-primary btn-lg" href="/fetch" role="button">Search</a>
                </form>
          </ul></div>

          <!-- 
              
            the below should load the details on when the database was last updated 
            
            we can have this only show up when a city is searched (so if we pre-load austin/taco,
                this label won't display)
        -->
          <div class="row">
              <div class="col-md-3"></div>
              <div class="col-md-3"></div>
              <div class="col-md-3"></div>
              <div class="col-md-3 offset-md-9" id="accessed">last updated: </div>
            </div>
        <div class="container-fluid" id='map'>                              
        </div>


<style>

  body {
    padding: 2px;
    margin: 0px;
  }

  #map,
  body,
  html {
    height: 100%;
  }

  #map {
      height: 75%;
      width: 75%;
  }
  
    .legend {
        line-height: 10px;
    color: #555;
    /* text-align: inline; */
    }
    .legend i {
    width: 20px;
    height: 20px;
    float: left;
    margin-right: 8px;
    opacity: 0.5;
}

.info {
    padding: 2px 4px;
    font: 12px/14px Arial, Helvetica, sans-serif;
    background: white;
    background: rgba(255,255,255,0.8);
    box-shadow: 0 0 15px rgba(0,0,0,0.2);
    border-radius: 10px;
}
.info h4 {
    margin: 0 0 5px;
    color: #777;
}

</style>

<script type="text/javascript">

var api_key = 'pk.eyJ1IjoibWFya29kYXRhdml6IiwiYSI6ImNqZWxyOGI2ZDRtNnUyd3FlN3B1Z2xmN2IifQ.0gVFx-w1WG9dfSpK5iyO_Q'

var mapbox = "https://api.mapbox.com/styles/v1/mapbox/outdoors-v10/tiles/256/{z}/{x}/{y}?" +
`access_token=${api_key}`;

var geojson;
var points;
var clusters = L.markerClusterGroup();

var myMap = L.map('map', {
  center: [36.7749, -97.4194],
  zoom: 5
});

L.tileLayer(mapbox).addTo(myMap);

var url2 ='http://data.beta.nyc//dataset/9572746e-5fec-4623-889a-eb6eb195101f/resource/0c322985-3c47-4a5f-a4ef-a27a8cf675b2/download/f28d740931ce480092d53307e6e37abageojsonmedianhouseholdincomecounty.geojson?limit=100'
var url ='cb_2017_us_zcta510_500k/zips.json'
    
d3.json(url, function(response){

d3.json(url2, function(response2){
  // console.log(response2);

var object = { a: 5, b: 6, c: 7  };
var picked = (({ a, c }) => ({ a, c }))(object);

// console.log(picked); // { a: 5, c: 7 }


var zip_list = [78745, 78704, 78749, 78739, 78748, 78745, 78735, 78744, 78741]
var zip_popp = [500,    1000, 5000,  25000,   10000, 50000, 15000, 7000, 50]

// var a = response.indexOf(78745);

// var a2 = response.features.findIndex(i => i.properties.ZCTA5CE10 == 78745);
// console.log(a2)
// console.log(response.features[a2])

var zip_array = [];

var zip_test = [];




zip_list.forEach(function(element) {
  // console.log(element);
  var a2 = response.features.findIndex(i => i.properties.ZCTA5CE10 == element);
  var zip_point_test = response.features[a2].geometry.coordinates[0][0];

  console.log(zip_point_test);
  // console.log(a2);
  // console.log(response.features[a2]);
  var random_ = Math.floor(Math.random() * 50000) + 500;
  // console.log(random_);
  // console.log(response.features[a2].properties);
  response.features[a2].properties['population'] = random_
  // console.log
  zip_array.push(response.features[a2]);
  zip_test.push(zip_point_test);
})


// L.geoJson(zip_array).addTo(myMap);
console.log(zip_array);

console.log(zip_test);


function getColor(d) {
    return d > 1000 ? '#800026' :
           d > 500  ? '#BD0026' :
           d > 200  ? '#E31A1C' :
           d > 100  ? '#FC4E2A' :
           d > 50   ? '#FD8D3C' :
           d > 20   ? '#FEB24C' :
           d > 10   ? '#FED976' :
                      '#FFEDA0';
}

function style(feature) {
    return {
        fillColor: getColor(feature.properties.population),
        weight: 2,
        opacity: 1,
        color: 'white',
        dashArray: '3',
        fillOpacity: 0.7
    };
}

function highlightFeature(e) {
    var layer = e.target;

    layer.setStyle({
        weight: 5,
        color: '#666',
        dashArray: '',
        fillOpacity: 0.7
    });

    if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
        layer.bringToFront();
    }
}
function resetHighlight(e) {
    geojson.resetStyle(e.target);
}

function zoomToFeature(e) {
    map.fitBounds(e.target.getBounds());
}

function onEachFeature(feature, layer) {
    layer.on({
        mouseover: highlightFeature,
        mouseout: resetHighlight
        // click: zoomToFeature
    }),
    layer.bindPopup( "<strong><center><h3>" + feature.properties.ZCTA5CE10 + "</strong></center></h3><br/>"
        + "<center>Current population: " + feature.properties.population + "</center>"
        + "<center>Median Household Income: " + feature.properties.mhi + "</center>" );
}

var vizIcon = L.icon({
      iconUrl: 'https://emojipedia-us.s3.amazonaws.com/thumbs/160/facebook/105/slice-of-pizza_1f355.png',
      iconSize: [60,50]
    });

var markers = L.markerClusterGroup();
 for (var i = 0; i < zip_test.length; i++) {
    var location = zip_test[i];

    console.log(location[0])

    if (location) {
            markers.addLayer(L.marker([location[1],location[0]],
          {icon: vizIcon}))
            .bindPopup(`<h3><center>lat: ${location[1]}</center></h3><r>lon:${location[0]}<br><br>extra stuff here`);
       }
       myMap.addLayer(markers);
  }



geojson = L.geoJson(zip_array, {
  style: style,
  onEachFeature: onEachFeature
  }).addTo(myMap);


var legend = L.control({position: 'topright'});

legend.onAdd = function (map) {

    var div = L.DomUtil.create('div', 'info legend'),
        grades = [0, 10, 20, 50, 100, 200, 500, 1000],
        labels = [];
        div.innerHTML += 'Population:<br/>'
    // loop through our density intervals and generate a label with a colored square for each interval
    for (var i = 0; i < grades.length; i++) {
        div.innerHTML +=
            '<i style="background:' + getColor(grades[i] + 1) + '">&nbsp&nbsp&nbsp</i> ' +
            grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] + '<br/>' : '+');
    }

    return div;
};

legend.addTo(myMap);

});
});

</script>

</body>
</html>
